<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Panic Button</title>
</head>

<body>
    <h1>Panic Button</h1>
    <a href="pconf-hu.html">Nyelv vÃ¡ltÃ¡sa ðŸ‡­ðŸ‡º Magyarra</a>
    <hr>
    <h3>Panic Key</h3>
    <p id="currentlyBoundKeyDisplay">Loading currently bound key...</p>
    <button onclick="startKeyIdentification()" id="changeBindingBtn">Change key binding...</button>
    <button onclick="resetToDefaultKeybind()" id="changeBindingBtn">Reset to default (F9)</button><br>
    <br>
    <hr>
    <h3>Panic REACTION</h3>
    <label for="pr">Choose a reaction:</label>
    <select name="pr" id="pr">
        <option value="fakedesktop">Show a fake desktop (full screen)</option>
        <option value="poweroff">Shut down the computer</option>
        <option value="logout">Log out of this computer</option>
        <option value="ythome">Open YouTube Homepage</option>
        <option value="ytcablesalty">Open @cablesalty's YouTube page</option>
        <option value="ytpearoo">Open @Pearoo's YouTube page</option>
        <option value="github">Open GitHub</option>
        <option value="facebook">Open Facebook (why tho?)</option>
    </select>
    <br>
    <label for="muteaudioselection">Mute audio?</label>
    <select name="muteaudioselection" id="muteaudioselection">
        <option value="mute">Mute audio</option>
        <option value="nomute">Do not mute audio</option>
    </select>
    <br>
    <hr>
    <button onclick="saveConfig()" id="saveConfigBtn">Save config</button>
    <button onclick="window.close();" id="saveConfigBtn">Close configuration window</button><br>
    <p style="color: red;">
        <i>Warning! Close the configuration window after you are done!
            Panic REACTION might NOT work if config window is open!
            PanicButton will remain running in the background until you quit
        </i>
    </p>

    <script>
        // Modules
        const fs = require('fs');

        // Read config.json synchronously
        const configPath = __dirname + '/config.json'; // Path to config
        const configData = fs.readFileSync(configPath, 'utf8'); // Read file
        const config = JSON.parse(configData); // Parse json
        const modifiedConfig = JSON.parse(JSON.stringify(config)); // Create duplicate (for modification)


        // Update values based on config
        document.getElementById("currentlyBoundKeyDisplay").innerHTML = "Currently bound key: " + config.panickey;



        // Key Identification
        let isIdentifying = false;

        function startKeyIdentification() {
            if (!isIdentifying) {
                document.getElementById("changeBindingBtn").innerHTML = "Press a button! (Click to cancel)";
                isIdentifying = true;
                document.addEventListener("keydown", keyDownHandler);
            } else {
                isIdentifying = false;
                document.removeEventListener("keydown", keyDownHandler);
                document.getElementById("changeBindingBtn").innerHTML = "Change key binding...";
            }
        }

        function keyDownHandler(event) {
            const keyPressedElement = document.getElementById("currentlyBoundKeyDisplay"); // Move this line here
            const pressedKey = event.key.toUpperCase();
            keyPressedElement.textContent = `Currently bound key: ${pressedKey}`;
            modifiedConfig.panickey = pressedKey;
            document.removeEventListener("keydown", keyDownHandler);
            isIdentifying = false;
            document.getElementById("changeBindingBtn").innerHTML = "Change key binding...";
        }


        // Resetting to default keybind
        function resetToDefaultKeybind() {
            modifiedConfig.panickey = "F9";
        }


        // Function saving
        async function saveConfig() {
            modifiedConfig.panicreaction = document.getElementById("pr").value;
            modifiedConfig.muteaudio = document.getElementById("muteaudioselection").value;

            fs.writeFileSync(configPath, JSON.stringify(modifiedConfig, null, 2));

            document.getElementById("saveConfigBtn").innerHTML = "Saved!";
            setTimeout(() => {
                document.getElementById("saveConfigBtn").innerHTML = "Save config";
            }, 2000);
        }
    </script>
</body>

</html>