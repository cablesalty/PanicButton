<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Panic Button</title>
</head>

<body>
    <h1>Panic Button // P√°nik Gomb</h1>
    <a href="pconf.html">Switch language to üá¨üáß/üá∫üá∏ English</a>
    <hr>
    <h3>P√°nik Billenyt≈±</h3>
    <p id="currentlyBoundKeyDisplay">Jelenleg be√°l√≠tott billenyt≈± bet√∂lt√©se</p>
    <button onclick="startKeyIdentification()" id="changeBindingBtn">Billenyt≈± m√≥dos√≠t√°sa</button>
    <button onclick="resetToDefaultKeybind()" id="changeBindingBtn">Alapbe√°ll√≠t√°s vissza√°ll√≠t√°sa (F9)</button><br>
    <br>
    <hr>
    <h3>P√°nik REAKCI√ì</h3>
    <label for="pr">V√°lassz "reakci√≥t":</label>
    <select name="pr" id="pr">
        <option value="fakedesktop">Hamis asztal megjelen√≠t√©se</option>
        <option value="poweroff">Sz√°m√≠t√≥g√©p le√°ll√≠t√°sa</option>
        <option value="logout">Kijelentkez√©s a sz√°m√≠t√≥g√©pb≈ël</option>
        <option value="ythome">YouTube Kezd≈ëlap megnyit√°sa</option>
        <option value="ytcablesalty">cablesalty YouTube csatorn√°ja</option>
        <option value="ytpearoo">Pearoo YouTube csatorn√°ja</option>
        <option value="github">Github megnyit√°sa</option>
        <option value="facebook">Facebook megnyit√°sa (mi√©rt?)</option>
    </select>
    <br>
    <label for="muteaudioselection">Rendszerhang n√©m√≠t√°sa?</label>
    <select name="muteaudioselection" id="muteaudioselection">
        <option value="mute">Legyen a rendszerhang len√©m√≠tva</option>
        <option value="nomute">Ne legyen a rendszerhang len√©m√≠tva</option>
    </select>
    <br>
    <hr>
    <button onclick="saveConfig()" id="saveConfigBtn">Konfigur√°ci√≥ ment√©se</button>
    <button onclick="window.close();" id="saveConfigBtn">Ablak bez√°r√°sa</button><br>
    <p style="color: red;">
        <i>Figyelem! Z√°rd be ezt az ablakot miut√°n v√©gezt√©l!
            El≈ëfordulhat, hogy a P√°nik REAKCI√ìK nem m≈±k√∂dnek ha ezt az ablakot nyitva hagyod!
            A P√°nik Gomb szoftver a h√°tt√©rben fog futni ameddig ki nem l√©psz a t√°lca seg√≠ts√©g√©vel (az a ny√≠l a t√°lc√°don)
        </i>
    </p>

    <script>
        // Modules
        const fs = require('fs');

        // Read config.json synchronously
        const configPath = __dirname + '/config.json'; // Path to config
        const configData = fs.readFileSync(configPath, 'utf8'); // Read file
        const config = JSON.parse(configData); // Parse json
        const modifiedConfig = JSON.parse(JSON.stringify(config)); // Create duplicate (for modification)


        // Update values based on config
        document.getElementById("currentlyBoundKeyDisplay").innerHTML = "Jelenleg be√°ll√≠tott billenty≈±: " + config.panickey;



        // Key Identification
        let isIdentifying = false;

        function startKeyIdentification() {
            if (!isIdentifying) {
                document.getElementById("changeBindingBtn").innerHTML = "Nyomj meg egy gombot! (kattints a megszak√≠t√°shoz)";
                isIdentifying = true;
                document.addEventListener("keydown", keyDownHandler);
            } else {
                isIdentifying = false;
                document.removeEventListener("keydown", keyDownHandler);
                document.getElementById("changeBindingBtn").innerHTML = "Billenyt≈± m√≥dos√≠t√°sa";
            }
        }

        function keyDownHandler(event) {
            const keyPressedElement = document.getElementById("currentlyBoundKeyDisplay"); // Move this line here
            const pressedKey = event.key.toUpperCase();
            keyPressedElement.textContent = `Jelenleg be√°ll√≠tott billenyt≈±: ${pressedKey}`;
            modifiedConfig.panickey = pressedKey;
            document.removeEventListener("keydown", keyDownHandler);
            isIdentifying = false;
            document.getElementById("changeBindingBtn").innerHTML = "Billenyt≈± m√≥dos√≠t√°sa";
        }


        // Resetting to default keybind
        function resetToDefaultKeybind() {
            modifiedConfig.panickey = "F9";
        }


        // Function saving
        async function saveConfig() {
            modifiedConfig.panicreaction = document.getElementById("pr").value;
            modifiedConfig.muteaudio = document.getElementById("muteaudioselection").value;

            fs.writeFileSync(configPath, JSON.stringify(modifiedConfig, null, 2));

            document.getElementById("saveConfigBtn").innerHTML = "Mentve!";
            setTimeout(() => {
                document.getElementById("saveConfigBtn").innerHTML = "Konfigur√°ci√≥ ment√©se";
            }, 2000);
        }
    </script>
</body>

</html>