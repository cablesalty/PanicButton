<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Panic Button</title>
</head>

<body>
    <h1>Panic Button</h1>
    <br>
    <h2>Panic Key</h2>
    <h3 id="currentlyBoundKeyDisplay">Loading currently bound key...</h3>
    <button onclick="startKeyIdentification()">Bind new...</button>
    <br>
    <br>
    <button onclick="saveConfig()" id="saveConfigBtn">Save config</button>

    <script>
        // Modules
        const fs = require('fs');

        const delay = ms => new Promise(res => setTimeout(res, ms));

        // Read config.json synchronously
        const configPath = __dirname + '/config.json'; // Path to config
        const configData = fs.readFileSync(configPath, 'utf8'); // Read file
        const config = JSON.parse(configData); // Parse json
        const modifiedConfig = JSON.parse(JSON.stringify(config)); // Create duplicate (for modification)


        // Update values based on config
        document.getElementById("currentlyBoundKeyDisplay").innerHTML = "Currently bound key: " + config.panickey;



        // Key Identification
        let isIdentifying = false;

        function startKeyIdentification() {
            if (!isIdentifying) {
                isIdentifying = true;
                document.addEventListener("keydown", keyDownHandler);
            }
        }

        function keyDownHandler(event) {
            const keyPressedElement = document.getElementById("currentlyBoundKeyDisplay"); // Move this line here
            const pressedKey = event.key.toUpperCase();
            keyPressedElement.textContent = `Currently bound key: ${pressedKey}`;
            modifiedConfig.panickey = pressedKey;
            document.removeEventListener("keydown", keyDownHandler);
            isIdentifying = false;
        }


        // Function saving
        async function saveConfig() {
            fs.writeFileSync(configPath, JSON.stringify(modifiedConfig, null, 2));
            await delay(2500);
            document.getElementById("saveConfigBtn").innerHTML = "Saved!";

        }
    </script>
</body>

</html>